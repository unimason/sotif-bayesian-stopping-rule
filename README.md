# 基于 Bayesian Stopping Rule 的可靠性测试评估（Poisson–Gamma）

本项目实现了一套 **基于贝叶斯方法的可靠性停止规则（Bayesian Stopping Rule）**，  
采用 **Poisson 失效过程 + Gamma 先验** 的经典建模方式，并针对 **自动驾驶 / SOTIF 场景测试**进行了工程化封装与可视化。

项目核心目标是回答一个非常实际的问题：

> **在测试过程中发生事故（或严重安全事件）之后，还需要补充多少无事故测试，才能在给定置信度下停止测试？**

---

## 1. 背景与动机

在自动驾驶与 SOTIF（ISO 21448）背景下：

- 场景空间巨大、长尾风险显著  
- 测试资源（时间 / 里程 / 人力）有限  
- 单纯依赖“跑够多少里程”缺乏可解释性  

传统可靠性目标常以如下形式出现：

> “以 99% 的置信度，系统的失效概率小于 10⁻³”

但这种表述存在两个问题：

1. **难以直接转化为工程决策**（发生事故后怎么办？）
2. **无法自然融合历史测试与仿真证据**

本项目采用 **Bayesian 可靠性建模**，将“测试证据”与“不确定性”显式建模，从而给出**可计算、可解释、可交互的停止规则**。

---

## 2. 模型概述

### 2.1 失效模型

- 系统失效（事故/严重事件）假设服从 **Poisson 过程**
- 失效率记为 λ（单位时间或单位里程的失效概率）

观测数据为：

- `r`：已发生的失效次数  
- `T`：累计测试时间（或等效里程）

---

### 2.2 先验与后验（Gamma–Poisson）

对失效率 λ 采用 Gamma 先验：

\[
\lambda \sim \mathrm{Gamma}(a, b)
\]

其中：

- `a`：先验等效失败次数（更准确地说是 *a−1*）
- `b`：先验等效无失败运行时间

在观测到 `(r, T)` 后，后验为：

\[
\lambda \mid (r, T) \sim \mathrm{Gamma}(a+r,\; b+T)
\]

**工程解释非常重要**：

> `a` 和 `b` 本质上是“虚拟历史数据”  
> - `a−1` 次失败  
> - `b` 单位的无事故运行时间  

---

## 3. Bayesian 停止规则（Stopping Rule）

给定可靠性要求：

- 目标失效率：`λ₀`
- 置信水平：`1 − α`

停止条件定义为：

\[
P(\lambda < \lambda_0 \mid r, T) \ge 1 - \alpha
\]

对于固定的 `(λ₀, α, a, b)` 和失败次数 `r`，  
可以计算满足条件所需的**最小总测试时间** `T*`。

该条件关于 `T` **单调递增**，因此可通过数值二分法高效求解。

---

## 4. 为什么这套方法适合 SOTIF

在 SOTIF 场景中：

- 很多系统并非“完全新系统”
- 已存在大量历史证据：
  - 历史版本实车里程
  - 仿真场景覆盖
  - HIL / SIL / 回归测试

如果简单设定 `b = 0`，等价于：

> **完全否认所有历史测试证据**

这在工程上往往 **过于保守**，会导致测试需求爆炸，却未必更安全。

本方法允许：

- 使用 `b` 显式编码历史无事故里程 / 仿真等效时间
- 使用 `a` 谨慎编码已知严重事故或系统性失效

从而实现 **可解释、可辩护的测试停止决策**。

---

## 5. 项目结构说明

```text
bayesian_stopping_rule/
├── README.md
├── requirements.txt
├── reliability/
│   ├── __init__.py
│   ├── priors.py          # 先验参数 a,b 的定义与封装
│   ├── posterior.py       # 后验分布与 CDF 计算
│   ├── stopping_rule.py   # 停止规则 / 补测时间计算
│   └── plotting.py        # 可复用绘图函数
├── demo_poisson_gamma.py  # 论文级复现与离线分析脚本
└── app_stopping_rule_ui.py# Streamlit 可视化与交互 UI
```

---

## 6. 安装依赖

```bash
pip install -r requirements.txt
```

---

## 7. 运行方式

### 7.1 离线分析脚本

```bash
python demo_poisson_gamma.py
```

### 7.2 Streamlit 交互界面

```bash
streamlit run app_stopping_rule_ui.py
```
